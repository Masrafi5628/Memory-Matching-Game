<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memory Matching Game</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: Arial, sans-serif;
        }
        #game-controls {
            margin-bottom: 20px;
        }
        #game-container {
            display: grid;
            grid-gap: 10px;
            justify-content: center;
        }
        .card {
            width: 100px;
            height: 100px;
            border: 2px solid #333;
            cursor: pointer;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #ccc;
        }
        .card canvas {
            width: 100%;
            height: 100%;
        }
        #step-counter {
            margin-top: 20px;
            font-size: 20px;
        }
    </style>
</head>
<body>
    <div id="game-controls">
        <label for="rows">Rows: </label>
        <input type="number" id="rows" min="1" value="2">
        <label for="cols">Columns: </label>
        <input type="number" id="cols" min="1" value="3">
        <button onclick="startGame()">Start Game</button>
    </div>
    <div id="game-container"></div>
    <div id="step-counter">Steps: 0</div>

    <script>
        let steps = 0;

        function startGame() {
            steps = 0;
            updateStepCounter();
            const rows = parseInt(document.getElementById('rows').value);
            const cols = parseInt(document.getElementById('cols').value);

            if (isNaN(rows) || rows < 1 || isNaN(cols) || cols < 1) {
                alert('Please enter valid numbers for rows and columns.');
                return;
            }

            const totalCards = rows * cols;
            if (totalCards % 2 !== 0) {
                alert('Please choose an even number of total cards.');
                return;
            }

            const colors = generateColors(totalCards / 2);
            const gameContainer = document.getElementById('game-container');
            gameContainer.innerHTML = '';
            let revealedCards = [];
            let matchedPairs = 0;

            gameContainer.style.gridTemplateColumns = `repeat(${cols}, 100px)`;

            for (let i = 0; i < totalCards; i++) {
                const card = document.createElement('div');
                card.classList.add('card');
                const canvas = document.createElement('canvas');
                canvas.width = 100;
                canvas.height = 100;
                card.appendChild(canvas);
                gameContainer.appendChild(card);
            }

            const cards = document.querySelectorAll('.card');
            colors.sort(() => 0.5 - Math.random());

            cards.forEach((card, index) => {
                const canvas = card.querySelector('canvas');
                const gl = canvas.getContext('webgl');

                if (!gl) {
                    console.error(`WebGL not supported for card ${index}`);
                    return;
                }

                card.dataset.color = colors[index];

                // Initialize the card with a gray color
                gl.clearColor(0.5, 0.5, 0.5, 1.0);
                gl.clear(gl.COLOR_BUFFER_BIT);

                card.addEventListener('click', function() {
                    if (revealedCards.length < 2 && !card.classList.contains('revealed')) {
                        steps++;
                        updateStepCounter();

                        const color = card.dataset.color;
                        const [r, g, b] = getColorComponents(color);
                        gl.clearColor(r, g, b, 1.0);
                        gl.clear(gl.COLOR_BUFFER_BIT);
                        card.classList.add('revealed');
                        revealedCards.push(card);

                        if (revealedCards.length === 2) {
                            const [firstCard, secondCard] = revealedCards;
                            if (firstCard.dataset.color === secondCard.dataset.color) {
                                revealedCards = [];
                                matchedPairs++;
                                if (matchedPairs === totalCards / 2) {
                                    alert(`You have matched all pairs in ${steps} steps!`);
                                }
                            } else {
                                setTimeout(() => {
                                    hideCard(firstCard);
                                    hideCard(secondCard);
                                    revealedCards = [];
                                }, 1000);
                            }
                        }
                    }
                });
            });
        }

        function generateColors(pairs) {
            const colors = [];
            for (let i = 0; i < pairs; i++) {
                const color = getRandomColor();
                colors.push(color, color);
            }
            return colors;
        }

        function getRandomColor() {
            const letters = '0123456789ABCDEF';
            let color = '#';
            for (let i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }

        function getColorComponents(color) {
            const r = parseInt(color.slice(1, 3), 16) / 255;
            const g = parseInt(color.slice(3, 5), 16) / 255;
            const b = parseInt(color.slice(5, 7), 16) / 255;
            return [r, g, b];
        }

        function hideCard(card) {
            const canvas = card.querySelector('canvas');
            const gl = canvas.getContext('webgl');
            gl.clearColor(0.5, 0.5, 0.5, 1.0);
            gl.clear(gl.COLOR_BUFFER_BIT);
            card.classList.remove('revealed');
        }

        function updateStepCounter() {
            document.getElementById('step-counter').textContent = `Steps: ${steps}`;
        }
    </script>
</body>
</html>
